services:
  podcast-tts:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: podcast-tts
    restart: unless-stopped

    ports:
      - "8005:8005"

    volumes:
      # Directorio de archivos de audio (persistente)
      - ./audio_articles:/data/audio_articles

      # Archivo de configuración
      - ./config.json:/data/config/config.json:ro

      # OPCIONAL: Certificados SSL personalizados
      # Descomenta y ajusta si usas certificados propios
      # - ./certs/ca-cert.pem:/data/certs/ca-cert.pem:ro
      # - ./certs:/data/certs:ro

    environment:
      # Zona horaria
      - TZ=Europe/Madrid

      # URL base para el feed (cámbiala por tu IP de Tailscale)
      - BASE_URL=http://100.90.91.96:8005

      # Título del podcast
      - PODCAST_TITLE=Mis Artículos TTS

      # Descripción del podcast
      - PODCAST_DESCRIPTION=Artículos convertidos a audio

      # Hora de actualización diaria (formato cron)
      - CRON_SCHEDULE=0 7 * * *

      # Voz predeterminada
      - DEFAULT_VOICE=es-ES-RyanNeural

      # Motor TTS (edge o gtts)
      # Si edge falla por SSL, usa gtts
      - TTS_ENGINE=edge

      # === CONFIGURACIÓN SSL ===
      # Opciones:
      # 1. VERIFY_SSL=true + sin SSL_CERT_FILE = usa certificados del sistema
      # 2. VERIFY_SSL=true + SSL_CERT_FILE=/ruta/cert.pem = usa certificado personalizado
      # 3. VERIFY_SSL=false = NO verificar SSL (solo para desarrollo/testing)

      # Verificar certificados SSL (true/false)
      # Si tienes problemas con HTTPS/SWAG, pon "false" temporalmente
      - VERIFY_SSL=false

      # Ruta al certificado CA personalizado (opcional)
      # Si tienes Let's Encrypt o certificados propios de SWAG
      # - SSL_CERT_FILE=/data/certs/ca-cert.pem

      # Variables de depuración
      # - PYTHONUNBUFFERED=1
      # - DEBUG=1

    # DNS configuration - CRÍTICO para resolver dominios externos
    dns:
      - 8.8.8.8
      - 8.8.4.4
      - 1.1.1.1

    # Opciones adicionales de DNS
    dns_search:
      - .

    # Permitir acceso a servicios en el host
    extra_hosts:
      - "host.docker.internal:host-gateway"

    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8005/podcast.xml || exit 1"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 60s

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
